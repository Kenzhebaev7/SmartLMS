<?php

namespace Database\Seeders;

use App\Models\Section;
use App\Models\Lesson;
use App\Models\Quiz;
use App\Models\Question;
use Illuminate\Database\Seeder;

class InformaticsSeeder extends Seeder
{
    public function run(): void
    {
        if (Section::count() > 0) {
            return;
        }

        $sections = [
            [
                'title' => 'Введение в информатику',
                'description' => 'Что такое информатика, информация, данные. Роль компьютера в современном мире.',
                'order' => 1,
                'level' => 'beginner',
                'lessons' => [
                    [
                        'title' => 'Что такое информатика',
                        'content' => "Информатика — наука о методах и процессах сбора, хранения, обработки и передачи информации с помощью компьютеров.\n\nОсновные направления: алгоритмы и алгоритмизация, программирование, базы данных, компьютерные сети, искусственный интеллект, информационная безопасность. Информатика связана с математикой, логикой и инженерией. В школе её изучают для развития алгоритмического мышления и умения решать задачи с помощью компьютера.",
                        'video_url' => 'https://www.youtube.com/watch?v=8WEtxJ4-sh4',
                        'video_id' => '8WEtxJ4-sh4',
                        'order' => 1,
                    ],
                    [
                        'title' => 'Информация и данные',
                        'content' => "Информация — сведения об объектах и явлениях окружающего мира, уменьшающие неопределённость.\n\nДанные — представление информации в формальном виде, пригодном для хранения и обработки на компьютере (числа, символы, сигналы). Единицы измерения: бит (0 или 1), байт (8 бит), килобайт (1024 байт), мегабайт, гигабайт. Кодирование — преобразование информации в данные. В компьютере всё хранится в двоичном коде.",
                        'video_url' => 'https://www.youtube.com/watch?v=1uqci6BXLM8',
                        'video_id' => '1uqci6BXLM8',
                        'order' => 2,
                    ],
                ],
                'quiz' => [
                    'title' => 'Квиз: Введение в информатику',
                    'passing_percent' => 70,
                    'questions' => [
                        ['text' => 'Информатика изучает:', 'options' => ['A' => 'Только программирование', 'B' => 'Методы сбора, хранения и обработки информации', 'C' => 'Только железо компьютера'], 'correct' => 'B'],
                        ['text' => 'Минимальная единица измерения информации:', 'options' => ['A' => 'Байт', 'B' => 'Бит', 'C' => 'Килобайт'], 'correct' => 'B'],
                    ],
                ],
            ],
            [
                'title' => 'Алгоритмы и основы логики',
                'description' => 'Понятие алгоритма, свойства алгоритмов, способы записи. Логические операции.',
                'order' => 2,
                'level' => 'beginner',
                'lessons' => [
                    [
                        'title' => 'Понятие алгоритма',
                        'content' => "Алгоритм — точная последовательность действий, приводящая от исходных данных к результату за конечное число шагов.\n\nСвойства: дискретность (разбиение на шаги), определённость (однозначность каждого шага), результативность (получение результата), массовость (применимость к целому классу задач). Способы записи: словесное описание, блок-схема, программа. Примеры: рецепт блюда, инструкция, навигатор, программа для компьютера.",
                        'video_url' => 'https://www.youtube.com/watch?v=2VBw9dX3L8E',
                        'video_id' => '2VBw9dX3L8E',
                        'order' => 1,
                    ],
                    [
                        'title' => 'Логические операции',
                        'content' => "Логика — основа принятия решений в программах. Высказывание может быть истинным или ложным.\n\nОперации: И (AND) — истина только когда оба условия истинны; ИЛИ (OR) — истина, если хотя бы одно истинно; НЕ (NOT) — инверсия. Таблицы истинности показывают результат для всех комбинаций. В алгоритмах: конструкция «если условие — то действие — иначе другое действие».",
                        'video_url' => 'https://www.youtube.com/watch?v=4_4RnpL6f_A',
                        'video_id' => '4_4RnpL6f_A',
                        'order' => 2,
                    ],
                ],
                'quiz' => [
                    'title' => 'Квиз: Алгоритмы',
                    'passing_percent' => 70,
                    'questions' => [
                        ['text' => 'Алгоритм должен быть:', 'options' => ['A' => 'Только быстрым', 'B' => 'Дискретным, определённым, результативным', 'C' => 'Написан на английском'], 'correct' => 'B'],
                        ['text' => 'Логическая операция ИЛИ даёт истину, когда:', 'options' => ['A' => 'Оба условия ложны', 'B' => 'Хотя бы одно условие истинно', 'C' => 'Оба истинны'], 'correct' => 'B'],
                    ],
                ],
            ],
            [
                'title' => 'Основы программирования',
                'description' => 'Переменные, типы данных, ветвления и циклы. Первые программы.',
                'order' => 3,
                'level' => 'beginner',
                'lessons' => [
                    [
                        'title' => 'Переменные и типы данных',
                        'content' => "Переменная — именованная ячейка памяти для хранения данных. Имя должно быть осмысленным.\n\nТипы данных: целое число (int), вещественное (float), строка (string), логический (bool). Присваивание: переменная = значение. Операции: арифметические (+, -, *, /), сравнение (==, !=, <, >, <=, >=). Типизация помогает избежать ошибок и делает код понятнее.",
                        'video_url' => 'https://www.youtube.com/watch?v=W8F9_2OHq2A',
                        'video_id' => 'W8F9_2OHq2A',
                        'order' => 1,
                    ],
                    [
                        'title' => 'Ветвления: if и else',
                        'content' => "Ветвление — выбор действия в зависимости от истинности условия.\n\nСинтаксис: if (условие) { действия } else { другие действия }. Можно использовать только if без else. Вложенные условия: if внутри if. Операторы сравнения: == (равно), != (не равно), <, >, <=, >=. Логические связки И, ИЛИ, НЕ для составных условий.",
                        'video_url' => 'https://www.youtube.com/watch?v=4_4RnpL6f_A',
                        'video_id' => '4_4RnpL6f_A',
                        'order' => 2,
                    ],
                    [
                        'title' => 'Циклы: for и while',
                        'content' => "Цикл — многократное выполнение одного и того же блока кода.\n\nЦикл for используют, когда известно количество повторений (например, перебор диапазона чисел или элементов списка). Цикл while выполняет тело, пока условие истинно — удобен, когда число итераций заранее неизвестно. Важно: предусмотреть выход из цикла, иначе получится бесконечный цикл.",
                        'video_url' => 'https://www.youtube.com/watch?v=r-7n_L0L2yc',
                        'video_id' => 'r-7n_L0L2yc',
                        'order' => 3,
                    ],
                ],
                'quiz' => [
                    'title' => 'Квиз: Основы программирования',
                    'passing_percent' => 70,
                    'questions' => [
                        ['text' => 'Переменная хранит:', 'options' => ['A' => 'Только числа', 'B' => 'Данные (числа, строки и т.д.)', 'C' => 'Только одну букву'], 'correct' => 'B'],
                        ['text' => 'Цикл for используют, когда:', 'options' => ['A' => 'Условие всегда ложно', 'B' => 'Известно количество повторений', 'C' => 'Нужна только одна итерация'], 'correct' => 'B'],
                    ],
                ],
            ],
            [
                'title' => 'Структуры данных',
                'description' => 'Массивы, списки. Работа с коллекциями данных.',
                'order' => 4,
                'level' => 'advanced',
                'lessons' => [
                    [
                        'title' => 'Массивы',
                        'content' => "Массив — упорядоченный набор элементов одного типа, доступных по индексу.\n\nИндексация обычно с нуля: первый элемент — индекс 0. Длина массива — количество элементов. Перебор: цикл for по индексам или по элементам. Одномерный массив — список; многомерный — массив массивов (например, таблица). Массивы позволяют хранить и обрабатывать большие наборы данных в программе.",
                        'video_url' => 'https://www.youtube.com/watch?v=7kXNd7q2dQY',
                        'video_id' => '7kXNd7q2dQY',
                        'order' => 1,
                    ],
                    [
                        'title' => 'Строки и операции над ними',
                        'content' => "Строка — последовательность символов (буквы, цифры, знаки). В коде задаётся в кавычках.\n\nОперации: конкатенация (склеивание строк), длина строки, срез (подстрока по индексам), поиск подстроки, замена. Во многих языках строки неизменяемы: операция создаёт новую строку. Строки можно перебирать посимвольно в цикле.",
                        'video_url' => 'https://www.youtube.com/watch?v=3VnrAJnQp2c',
                        'video_id' => '3VnrAJnQp2c',
                        'order' => 2,
                    ],
                ],
                'quiz' => [
                    'title' => 'Квиз: Структуры данных',
                    'passing_percent' => 70,
                    'questions' => [
                        ['text' => 'Индексация элементов массива часто начинается с:', 'options' => ['A' => '1', 'B' => '0', 'C' => '-1'], 'correct' => 'B'],
                        ['text' => 'Массив хранит элементы:', 'options' => ['A' => 'Только разных типов', 'B' => 'Обычно одного типа, упорядоченно', 'C' => 'Только числа'], 'correct' => 'B'],
                    ],
                ],
            ],
            [
                'title' => 'Базы данных и SQL',
                'description' => 'Реляционные БД, таблицы, запросы SELECT, INSERT, UPDATE.',
                'order' => 5,
                'level' => 'advanced',
                'lessons' => [
                    [
                        'title' => 'Что такое база данных',
                        'content' => "База данных (БД) — организованное хранилище данных, позволяющее быстро добавлять, искать, изменять и удалять записи.\n\nРеляционная БД хранит данные в виде таблиц (строки и столбцы) и связей между таблицами по ключам. СУБД — система управления базами данных (MySQL, PostgreSQL, SQLite и др.) обеспечивает надёжность, безопасность и многопользовательский доступ. БД используются в сайтах, приложениях, учёте и отчётности.",
                        'video_url' => 'https://www.youtube.com/watch?v=HXV3zeQKqGY',
                        'video_id' => 'HXV3zeQKqGY',
                        'order' => 1,
                    ],
                    [
                        'title' => 'Запросы SELECT',
                        'content' => "SQL — язык запросов к реляционным БД. Основная команда выборки — SELECT.\n\nСинтаксис: SELECT столбцы FROM таблица WHERE условие. Можно выбирать все столбцы (*) или перечислять нужные. WHERE задаёт фильтр по условию. ORDER BY — сортировка (ASC по возрастанию, DESC по убыванию). LIMIT — ограничение числа строк. Условия связываются через AND, OR, скобки.",
                        'video_url' => 'https://www.youtube.com/watch?v=HXV3zeQKqGY',
                        'video_id' => 'HXV3zeQKqGY',
                        'order' => 2,
                    ],
                ],
                'quiz' => [
                    'title' => 'Квиз: Базы данных',
                    'passing_percent' => 70,
                    'questions' => [
                        ['text' => 'Реляционная БД хранит данные в виде:', 'options' => ['A' => 'Только одного файла', 'B' => 'Таблиц и связей между ними', 'C' => 'Только в облаке'], 'correct' => 'B'],
                        ['text' => 'Язык запросов к реляционным БД:', 'options' => ['A' => 'Python', 'B' => 'SQL', 'C' => 'HTML'], 'correct' => 'B'],
                    ],
                ],
            ],
        ];

        foreach ($sections as $s) {
            $quizData = $s['quiz'];
            unset($s['quiz']);
            $lessonsData = $s['lessons'];
            unset($s['lessons']);

            $section = Section::create($s);

            foreach ($lessonsData as $l) {
                $section->lessons()->create(array_merge($l, ['file_path' => null]));
            }

            $quiz = $section->quiz()->create([
                'title' => $quizData['title'],
                'passing_percent' => $quizData['passing_percent'],
            ]);

            foreach ($quizData['questions'] as $i => $q) {
                $quiz->questions()->create([
                    'text' => $q['text'],
                    'type' => 'single',
                    'options' => $q['options'],
                    'correct_answer' => [$q['correct']],
                    'order' => $i,
                ]);
            }
        }
    }
}
